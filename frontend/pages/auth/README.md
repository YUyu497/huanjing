# ç”¨æˆ·è®¤è¯ç³»ç»Ÿ

ç”¨æˆ·ç™»å½•æ³¨å†ŒåŠŸèƒ½ï¼Œä½¿ç”¨QQé‚®ç®±éªŒè¯ç è¿›è¡Œèº«ä»½éªŒè¯ã€‚

## æ–‡ä»¶ç»“æ„

```
auth/
â”œâ”€â”€ auth.html          # ç™»å½•æ³¨å†Œé¡µé¢HTML
â”œâ”€â”€ auth.css           # é¡µé¢æ ·å¼æ–‡ä»¶
â”œâ”€â”€ auth.js            # é¡µé¢äº¤äº’é€»è¾‘
â””â”€â”€ README.md          # è¯´æ˜æ–‡æ¡£
```

## åŠŸèƒ½ç‰¹æ€§

### ğŸ” **ç”¨æˆ·æ³¨å†Œ**
- QQé‚®ç®±éªŒè¯æ³¨å†Œ
- ç”¨æˆ·åå”¯ä¸€æ€§æ£€æŸ¥
- å¯†ç å¼ºåº¦éªŒè¯
- é‚®ç®±éªŒè¯ç éªŒè¯
- å®æ—¶è¡¨å•éªŒè¯

### ğŸšª **ç”¨æˆ·ç™»å½•**
- QQé‚®ç®±éªŒè¯ç ç™»å½•
- ä¼šè¯ç®¡ç†
- è‡ªåŠ¨ç™»å½•çŠ¶æ€æ£€æŸ¥

### ğŸ“§ **é‚®ç®±éªŒè¯**
- 6ä½æ•°å­—éªŒè¯ç 
- 10åˆ†é’Ÿæœ‰æ•ˆæœŸ
- 60ç§’å‘é€é—´éš”é™åˆ¶
- ç¾è§‚çš„é‚®ä»¶æ¨¡æ¿

### ğŸ›¡ï¸ **å®‰å…¨ç‰¹æ€§**
- å¯†ç åŠ å¯†å­˜å‚¨ï¼ˆbcryptï¼‰
- ä¼šè¯ä»¤ç‰Œç®¡ç†
- è¯·æ±‚é¢‘ç‡é™åˆ¶
- è¾“å…¥éªŒè¯å’Œè¿‡æ»¤
- CSRFä¿æŠ¤

## APIæ¥å£

### å‘é€éªŒè¯ç 
```http
POST /api/auth/send-verification
Content-Type: application/json

{
  "email": "user@qq.com",
  "type": "register|login|reset_password"
}
```

### ç”¨æˆ·æ³¨å†Œ
```http
POST /api/auth/register
Content-Type: application/json

{
  "email": "user@qq.com",
  "username": "username",
  "displayName": "Display Name",
  "password": "password123",
  "verificationCode": "123456"
}
```

### ç”¨æˆ·ç™»å½•
```http
POST /api/auth/login
Content-Type: application/json

{
  "email": "user@qq.com",
  "verificationCode": "123456"
}
```

### éªŒè¯ä¼šè¯
```http
GET /api/auth/verify-session
Authorization: Bearer <session_token>
```

### ç”¨æˆ·ç™»å‡º
```http
POST /api/auth/logout
Authorization: Bearer <session_token>
```

## å‰ç«¯åŠŸèƒ½

### è¡¨å•éªŒè¯
- **é‚®ç®±éªŒè¯**ï¼šå¿…é¡»æ˜¯æœ‰æ•ˆçš„QQé‚®ç®±ï¼ˆ@qq.comç»“å°¾ï¼‰
- **ç”¨æˆ·åéªŒè¯**ï¼š3-20ä½å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿
- **å¯†ç éªŒè¯**ï¼šè‡³å°‘6ä½ï¼ŒåŒ…å«å¤§å°å†™å­—æ¯å’Œæ•°å­—
- **ç¡®è®¤å¯†ç **ï¼šä¸åŸå¯†ç ä¸€è‡´
- **éªŒè¯ç **ï¼š6ä½æ•°å­—

### ç”¨æˆ·ä½“éªŒ
- å®æ—¶è¡¨å•éªŒè¯
- åŠ è½½çŠ¶æ€æŒ‡ç¤º
- é”™è¯¯ä¿¡æ¯æç¤º
- æˆåŠŸçŠ¶æ€åé¦ˆ
- éªŒè¯ç å€’è®¡æ—¶
- å¯†ç æ˜¾ç¤ºåˆ‡æ¢
- å“åº”å¼è®¾è®¡

### åŠ¨ç”»æ•ˆæœ
- AOSæ»šåŠ¨åŠ¨ç”»
- è¡¨å•åˆ‡æ¢åŠ¨ç”»
- æŒ‰é’®åŠ è½½åŠ¨ç”»
- é€šçŸ¥å¼¹çª—åŠ¨ç”»

## æ•°æ®åº“è¡¨ç»“æ„

### users è¡¨
- `id` - ç”¨æˆ·IDï¼ˆä¸»é”®ï¼‰
- `username` - ç”¨æˆ·åï¼ˆå”¯ä¸€ï¼‰
- `email` - é‚®ç®±åœ°å€ï¼ˆå”¯ä¸€ï¼‰
- `password_hash` - å¯†ç å“ˆå¸Œ
- `display_name` - æ˜¾ç¤ºåç§°
- `avatar_url` - å¤´åƒURL
- `is_verified` - é‚®ç®±æ˜¯å¦éªŒè¯
- `is_active` - è´¦æˆ·æ˜¯å¦æ¿€æ´»
- `role` - ç”¨æˆ·è§’è‰²
- `last_login` - æœ€åç™»å½•æ—¶é—´
- `created_at` - åˆ›å»ºæ—¶é—´
- `updated_at` - æ›´æ–°æ—¶é—´

### email_verifications è¡¨
- `id` - éªŒè¯è®°å½•ID
- `email` - é‚®ç®±åœ°å€
- `verification_code` - éªŒè¯ç 
- `type` - éªŒè¯ç±»å‹
- `expires_at` - è¿‡æœŸæ—¶é—´
- `is_used` - æ˜¯å¦å·²ä½¿ç”¨
- `created_at` - åˆ›å»ºæ—¶é—´

### user_sessions è¡¨
- `id` - ä¼šè¯ID
- `user_id` - ç”¨æˆ·ID
- `session_token` - ä¼šè¯ä»¤ç‰Œ
- `ip_address` - IPåœ°å€
- `user_agent` - ç”¨æˆ·ä»£ç†
- `expires_at` - è¿‡æœŸæ—¶é—´
- `is_active` - æ˜¯å¦æ¿€æ´»
- `created_at` - åˆ›å»ºæ—¶é—´
- `updated_at` - æ›´æ–°æ—¶é—´

## ç¯å¢ƒé…ç½®

### åç«¯ç¯å¢ƒå˜é‡
```env
# QQé‚®ç®±é…ç½®
QQ_EMAIL_USER=your_qq_email@qq.com
QQ_EMAIL_PASS=your_qq_email_authorization_code

# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=3306
DB_NAME=huanjing_fivem
DB_USER=root
DB_PASSWORD=your_password
```

### QQé‚®ç®±è®¾ç½®
1. ç™»å½•QQé‚®ç®±
2. è®¾ç½® â†’ è´¦æˆ·
3. å¼€å¯SMTPæœåŠ¡
4. è·å–æˆæƒç 
5. å°†æˆæƒç é…ç½®åˆ°ç¯å¢ƒå˜é‡

## å®‰è£…ä¾èµ–

```bash
cd backend
npm install bcrypt nodemailer express-rate-limit express-validator
```

## ä½¿ç”¨è¯´æ˜

### 1. æ•°æ®åº“åˆå§‹åŒ–
```bash
# æ‰§è¡ŒSQLæ–‡ä»¶åˆ›å»ºç”¨æˆ·ç›¸å…³è¡¨
mysql -u root -p huanjing_fivem < sql/0.0.1.sql
```

### 2. é…ç½®ç¯å¢ƒå˜é‡
```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp backend/.env.example backend/.env

# ç¼–è¾‘é…ç½®æ–‡ä»¶
vim backend/.env
```

### 3. å¯åŠ¨æœåŠ¡
```bash
cd backend
npm start
```

### 4. è®¿é—®é¡µé¢
æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š`http://localhost:3000/pages/auth/auth.html`

## å®‰å…¨æ³¨æ„äº‹é¡¹

1. **å¯†ç å®‰å…¨**
   - ä½¿ç”¨bcryptåŠ å¯†å­˜å‚¨
   - å¯†ç å¼ºåº¦è¦æ±‚
   - é˜²æ­¢å¯†ç æš´åŠ›ç ´è§£

2. **ä¼šè¯å®‰å…¨**
   - ä¼šè¯ä»¤ç‰Œéšæœºç”Ÿæˆ
   - è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´
   - æ”¯æŒä¸»åŠ¨ç™»å‡º

3. **é‚®ç®±éªŒè¯**
   - éªŒè¯ç æœ‰æ•ˆæœŸé™åˆ¶
   - å‘é€é¢‘ç‡é™åˆ¶
   - é˜²æ­¢éªŒè¯ç æš´åŠ›ç ´è§£

4. **è¾“å…¥éªŒè¯**
   - å‰åç«¯åŒé‡éªŒè¯
   - é˜²æ­¢SQLæ³¨å…¥
   - é˜²æ­¢XSSæ”»å‡»

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **é‚®ä»¶å‘é€å¤±è´¥**
   - æ£€æŸ¥QQé‚®ç®±æˆæƒç 
   - ç¡®è®¤SMTPæœåŠ¡å·²å¼€å¯
   - æ£€æŸ¥ç½‘ç»œè¿æ¥

2. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   - æ£€æŸ¥æ•°æ®åº“é…ç½®
   - ç¡®è®¤æ•°æ®åº“æœåŠ¡è¿è¡Œ
   - æ£€æŸ¥ç”¨æˆ·æƒé™

3. **éªŒè¯ç æ— æ•ˆ**
   - æ£€æŸ¥éªŒè¯ç æ˜¯å¦è¿‡æœŸ
   - ç¡®è®¤é‚®ç®±åœ°å€æ­£ç¡®
   - æ£€æŸ¥éªŒè¯ç è¾“å…¥

4. **ä¼šè¯å¤±æ•ˆ**
   - æ£€æŸ¥ä¼šè¯æ˜¯å¦è¿‡æœŸ
   - ç¡®è®¤ä»¤ç‰Œæ ¼å¼æ­£ç¡®
   - é‡æ–°ç™»å½•è·å–æ–°ä¼šè¯

## æ›´æ–°æ—¥å¿—

### v0.0.1 (2024-01-15)
- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- å®ç°åŸºç¡€ç™»å½•æ³¨å†ŒåŠŸèƒ½
- QQé‚®ç®±éªŒè¯ç æ”¯æŒ
- ä¼šè¯ç®¡ç†ç³»ç»Ÿ
- å“åº”å¼ç•Œé¢è®¾è®¡
